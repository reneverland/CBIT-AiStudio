# ğŸš€ CBIT-AiStudio é¢„ç½®æ•°æ®åº“è§£å†³æ–¹æ¡ˆæŒ‡å—

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**å½»åº•è§£å†³æ•°æ®åº“æƒé™é—®é¢˜**çš„æ–¹æ¡ˆï¼Œé€šè¿‡å°†SQLiteæ•°æ®åº“æ–‡ä»¶ç›´æ¥æ‰“åŒ…åˆ°Dockeré•œåƒä¸­ï¼Œå®Œå…¨é¿å…å®¿ä¸»æœºæƒé™é—®é¢˜ã€‚

### ğŸ¯ è§£å†³çš„é—®é¢˜
- âœ… `sqlite3.OperationalError: unable to open database file`
- âœ… Dockerå®¹å™¨æ•°æ®åº“æƒé™é—®é¢˜
- âœ… å®¿ä¸»æœºä¸å®¹å™¨ç”¨æˆ·æƒé™å†²çª
- âœ… æ•°æ®åº“æ–‡ä»¶è®¿é—®æƒé™é—®é¢˜

### ğŸ’¡ æ–¹æ¡ˆåŸç†
1. **é¢„ç½®æ•°æ®åº“**ï¼šåœ¨æ„å»ºæ—¶åˆ›å»ºæ•°æ®åº“æ–‡ä»¶
2. **æ‰“åŒ…åˆ°é•œåƒ**ï¼šå°†æ•°æ®åº“æ–‡ä»¶åŒ…å«åœ¨Dockeré•œåƒä¸­
3. **å®¹å™¨å†…å¤åˆ¶**ï¼šå¯åŠ¨æ—¶å¤åˆ¶åˆ°è¿è¡Œæ—¶ä½ç½®
4. **æ— å¤–éƒ¨ä¾èµ–**ï¼šå®Œå…¨ä¸ä¾èµ–å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæƒé™

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®éƒ¨ç½²
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
./deploy_prebuilt_db.sh
```

### æ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤

1. **åˆ›å»ºé¢„ç½®æ•°æ®åº“**
   ```bash
   python3 create_prebuilt_db.py
   ```

2. **æ„å»ºé¢„ç½®æ•°æ®åº“ç‰ˆæœ¬**
   ```bash
   docker-compose -f docker-compose.prebuilt.yml build --no-cache
   ```

3. **å¯åŠ¨æœåŠ¡**
   ```bash
   docker-compose -f docker-compose.prebuilt.yml up -d
   ```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
CBIT-AiStudio/
â”œâ”€â”€ db/                                    # é¢„ç½®æ•°æ®åº“ç›®å½•
â”‚   â””â”€â”€ prebuilt_cache.db                 # é¢„ç½®æ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ app_prebuilt_db.py                    # é¢„ç½®æ•°æ®åº“ç‰ˆæœ¬åº”ç”¨
â”œâ”€â”€ create_prebuilt_db.py                 # æ•°æ®åº“åˆ›å»ºè„šæœ¬
â”œâ”€â”€ Dockerfile.prebuilt                   # é¢„ç½®æ•°æ®åº“Dockerfile
â”œâ”€â”€ docker-compose.prebuilt.yml          # é¢„ç½®æ•°æ®åº“composeæ–‡ä»¶
â”œâ”€â”€ deploy_prebuilt_db.sh                 # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ manage_prebuilt.sh                    # ç®¡ç†è„šæœ¬
â””â”€â”€ é¢„ç½®æ•°æ®åº“è§£å†³æ–¹æ¡ˆæŒ‡å—.md             # æœ¬æ–‡æ¡£
```

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

ä½¿ç”¨ `manage_prebuilt.sh` è„šæœ¬ç®¡ç†æœåŠ¡ï¼š

```bash
# å¯åŠ¨æœåŠ¡
./manage_prebuilt.sh start

# åœæ­¢æœåŠ¡
./manage_prebuilt.sh stop

# é‡å¯æœåŠ¡
./manage_prebuilt.sh restart

# é‡å»ºé•œåƒ
./manage_prebuilt.sh rebuild

# æŸ¥çœ‹æ—¥å¿—
./manage_prebuilt.sh logs

# æ£€æŸ¥çŠ¶æ€
./manage_prebuilt.sh status

# å¥åº·æ£€æŸ¥
./manage_prebuilt.sh health

# æ•°æ®åº“ä¿¡æ¯
./manage_prebuilt.sh db-info

# è¿›å…¥å®¹å™¨
./manage_prebuilt.sh shell
```

## ğŸ” éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
```bash
docker ps | grep cbit-aistudio-prebuilt
```

### 2. å¥åº·æ£€æŸ¥
```bash
curl http://localhost:5000/health
```

**æœŸæœ›è¾“å‡º**ï¼š
```json
{
  "status": "ok",
  "local": true,
  "server": true,
  "database": true,
  "database_status": "connected",
  "database_uri": "sqlite:///db/runtime_cache.db",
  "prebuilt_db": true,
  "timestamp": "2025-10-03T..."
}
```

### 3. æ£€æŸ¥æ•°æ®åº“
```bash
./manage_prebuilt.sh db-info
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ•°æ®åº“æµç¨‹
1. **æ„å»ºæ—¶**ï¼š`create_prebuilt_db.py` åˆ›å»º `db/prebuilt_cache.db`
2. **é•œåƒæ‰“åŒ…**ï¼šDockerfile å°†æ•°æ®åº“æ–‡ä»¶å¤åˆ¶åˆ° `/app/db/prebuilt_cache.db`
3. **è¿è¡Œæ—¶**ï¼šåº”ç”¨å¯åŠ¨æ—¶å¤åˆ¶åˆ° `/app/db/runtime_cache.db`
4. **ä½¿ç”¨**ï¼šåº”ç”¨è¿æ¥åˆ°è¿è¡Œæ—¶æ•°æ®åº“æ–‡ä»¶

### æƒé™è®¾ç½®
```dockerfile
# åœ¨Dockerfileä¸­è®¾ç½®
RUN chmod 666 /app/db/prebuilt_cache.db && \
    chmod 777 /app/db
```

### å¯åŠ¨è„šæœ¬
```bash
# å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œ
if [ -f /app/db/prebuilt_cache.db ]; then
    echo "âœ… é¢„ç½®æ•°æ®åº“å­˜åœ¨"
    # å¤åˆ¶åˆ°è¿è¡Œæ—¶ä½ç½®
    cp /app/db/prebuilt_cache.db /app/db/runtime_cache.db
    chmod 666 /app/db/runtime_cache.db
fi
```

## ğŸ†š ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | é¢„ç½®æ•°æ®åº“æ–¹æ¡ˆ | æƒé™ä¿®å¤æ–¹æ¡ˆ | ç´§æ€¥ä¿®å¤æ–¹æ¡ˆ |
|------|---------------|-------------|-------------|
| **è§£å†³å½»åº•æ€§** | ğŸŸ¢ å®Œå…¨è§£å†³ | ğŸŸ¡ å¤§éƒ¨åˆ†è§£å†³ | ğŸŸ¡ å¼ºåŠ›è§£å†³ |
| **éƒ¨ç½²å¤æ‚åº¦** | ğŸŸ¢ ç®€å• | ğŸŸ¡ ä¸­ç­‰ | ğŸ”´ å¤æ‚ |
| **æ•°æ®æŒä¹…åŒ–** | ğŸ”´ ä¸æŒä¹…åŒ– | ğŸŸ¢ å®Œå…¨æŒä¹…åŒ– | ğŸŸ¢ å®Œå…¨æŒä¹…åŒ– |
| **æƒé™ä¾èµ–** | ğŸŸ¢ æ— ä¾èµ– | ğŸ”´ ä¾èµ–å®¿ä¸»æœº | ğŸ”´ ä¾èµ–å®¿ä¸»æœº |
| **é€‚ç”¨åœºæ™¯** | ğŸŸ¢ å¼€å‘/æµ‹è¯• | ğŸŸ¢ ç”Ÿäº§ç¯å¢ƒ | ğŸŸ¢ ç´§æ€¥ä¿®å¤ |

## ğŸ’¾ æ•°æ®ç®¡ç†

### æ•°æ®ä¸æŒä¹…åŒ–è¯´æ˜
- âš ï¸ **é‡è¦**ï¼šæ­¤æ–¹æ¡ˆä¸­æ•°æ®åº“åœ¨å®¹å™¨å†…ï¼Œå®¹å™¨åˆ é™¤åæ•°æ®ä¸¢å¤±
- ğŸ¯ **é€‚ç”¨åœºæ™¯**ï¼šå¼€å‘ã€æµ‹è¯•ã€æ¼”ç¤ºç¯å¢ƒ
- ğŸ’¡ **ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®ä½¿ç”¨æƒé™ä¿®å¤æ–¹æ¡ˆæˆ–å¤–éƒ¨æ•°æ®åº“

### æ•°æ®å¯¼å‡ºï¼ˆå¦‚éœ€è¦ï¼‰
```bash
# è¿›å…¥å®¹å™¨
./manage_prebuilt.sh shell

# åœ¨å®¹å™¨å†…å¯¼å‡ºæ•°æ®
sqlite3 /app/db/runtime_cache.db .dump > /app/downloads/backup.sql

# ä»å®¿ä¸»æœºå¤åˆ¶
docker cp cbit-aistudio-prebuilt:/app/downloads/backup.sql ./backup.sql
```

### æ•°æ®å¯¼å…¥ï¼ˆå¦‚éœ€è¦ï¼‰
```bash
# å¤åˆ¶SQLæ–‡ä»¶åˆ°å®¹å™¨
docker cp backup.sql cbit-aistudio-prebuilt:/app/downloads/

# è¿›å…¥å®¹å™¨å¯¼å…¥
./manage_prebuilt.sh shell
sqlite3 /app/db/runtime_cache.db < /app/downloads/backup.sql
```

## ğŸ”„ åˆ‡æ¢åˆ°å…¶ä»–æ–¹æ¡ˆ

### åˆ‡æ¢åˆ°æƒé™ä¿®å¤æ–¹æ¡ˆ
```bash
# åœæ­¢é¢„ç½®æ•°æ®åº“ç‰ˆæœ¬
./manage_prebuilt.sh stop

# å¯åŠ¨æƒé™ä¿®å¤ç‰ˆæœ¬
./fix_database_permissions.sh
```

### åˆ‡æ¢åˆ°ç´§æ€¥ä¿®å¤æ–¹æ¡ˆ
```bash
# åœæ­¢é¢„ç½®æ•°æ®åº“ç‰ˆæœ¬
./manage_prebuilt.sh stop

# è¿è¡Œç´§æ€¥ä¿®å¤
./emergency_force_fix.sh
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q1: å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Ÿ**
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./manage_prebuilt.sh logs

# æ£€æŸ¥é¢„ç½®æ•°æ®åº“
ls -la db/prebuilt_cache.db
```

**Q2: å¥åº·æ£€æŸ¥å¤±è´¥ï¼Ÿ**
```bash
# æ£€æŸ¥å®¹å™¨å†…æ•°æ®åº“
./manage_prebuilt.sh db-info

# è¿›å…¥å®¹å™¨è°ƒè¯•
./manage_prebuilt.sh shell
```

**Q3: æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨ï¼Ÿ**
```bash
# é‡æ–°åˆ›å»ºé¢„ç½®æ•°æ®åº“
python3 create_prebuilt_db.py

# é‡å»ºé•œåƒ
./manage_prebuilt.sh rebuild
```

## ğŸ¯ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ
- âœ… ä½¿ç”¨é¢„ç½®æ•°æ®åº“æ–¹æ¡ˆ
- âœ… å¿«é€Ÿå¯åŠ¨ï¼Œæ— æƒé™é—®é¢˜
- âœ… æ•°æ®é‡ç½®ç®€å•

### æµ‹è¯•ç¯å¢ƒ
- âœ… ä½¿ç”¨é¢„ç½®æ•°æ®åº“æ–¹æ¡ˆ
- âœ… ç¯å¢ƒä¸€è‡´æ€§å¥½
- âœ… éƒ¨ç½²ç®€å•

### ç”Ÿäº§ç¯å¢ƒ
- âš ï¸ è€ƒè™‘æ•°æ®æŒä¹…åŒ–éœ€æ±‚
- ğŸ’¡ å¦‚éœ€æŒä¹…åŒ–ï¼Œä½¿ç”¨æƒé™ä¿®å¤æ–¹æ¡ˆ
- ğŸ’¡ å¦‚ä¸éœ€æŒä¹…åŒ–ï¼Œå¯ä½¿ç”¨é¢„ç½®æ•°æ®åº“æ–¹æ¡ˆ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š`./manage_prebuilt.sh logs`
2. **æ£€æŸ¥çŠ¶æ€**ï¼š`./manage_prebuilt.sh status`
3. **å¥åº·æ£€æŸ¥**ï¼š`./manage_prebuilt.sh health`
4. **é‡å»ºæœåŠ¡**ï¼š`./manage_prebuilt.sh rebuild`

---

**ğŸ‰ é¢„ç½®æ•°æ®åº“æ–¹æ¡ˆå½»åº•è§£å†³äº†æƒé™é—®é¢˜ï¼Œè®©ä½ çš„åº”ç”¨ç¨³å®šè¿è¡Œï¼**
